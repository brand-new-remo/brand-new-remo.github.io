---
date: 2024-06-03
category:
  - Vue
tag:
  - Vue
  - Diff
---

# **Vue3在diff阶段都优化了哪些**

## 静态提升

在`模板编译时`，会将没有用到`动态变量`的`节点或属性(class、style这些元素属性)`进行`静态提升`，在进行render时，直接复用旧节点。而在`Vue2中`，无论元素是否使用了`动态变量`，每次更新都会`重新创建`，这也是为什么`Vue3`最好使用`template`而不是render函数，因为模板编译时会帮我们做优化；

## 预字符串化

当编译器遇到`大量的静态节点时`，会将这一整部分变成字符串，`减少VNode的创建`，渲染为`静态节点`，而在Vue2中，则会将这些节点一个个变成虚拟节点；

## 缓存事件处理函数

在Vue3中，会将dom元素绑定的事件进行`缓存`，在进行patch的时候会使用缓存中的事件处理函数；

## Block Tree

在Vue3中，`Block`用于提取那些`动态属性`的节点，从而在进行更新时，可以精准的比较`Block中的内容`，只更新那些使用动态节点的节点；

## patchFlags

`patchFlags`是编译器生成的`优化提示`，它标记了节点的哪些属性是`动态的`，从而在进行更新时，精确的对某些属性进行更新；

## shapeFlags

`shapeFlags`也是一个标识，它标识了当前虚拟节点的类型，从而可以在进行diff时能够省去`类型判断`，对不同类型做不同的更新处理。

## 快速路径和节点缓存

Vue 3 在 diff 过程中使用了快速路径（fast path）和节点缓存机制，可以快速跳过不必要的比较和操作，提高了 diff 的效率。这些优化可以减少不必要的 DOM 操作，从而减少页面的重绘和重排，提高了整体的渲染性能。

## 优化的算法

Vue 3 在实现 diff 算法时采用了一些优化的策略和算法，例如深度优先遍历算法、双端比较算法等，以提高 diff 的效率和性能。
